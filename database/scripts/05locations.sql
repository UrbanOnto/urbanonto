-- ALTER TABLE ontology_sources.locations_refined ALTER COLUMN the_geom TYPE geometry(Geometry,4326);
-- DELETE FROM ontology_sources.locations_refined;
WITH locations_geo AS (SELECT l.identifiers,(regexp_matches(l."the_geom_X_Y",'^\s*([0-9]{1,2}(?:\.[0-9]+))\s*\,\s*([0-9]{1,2}(?:\.[0-9]+))\s*$')) AS geo,l.names,ld.identifiers AS location_dataset_identifers FROM ontology_sources.locations_raw l LEFT JOIN ontology.location_datasets ld ON (l.location_dataset_identifers = ld.names) ORDER BY identifiers) INSERT INTO ontology.locations SELECT identifiers, ST_SetSRID(ST_Point(geo[2]::double precision,geo[1]::double precision),4326) AS the_geom, names, location_dataset_identifers FROM locations_geo;
